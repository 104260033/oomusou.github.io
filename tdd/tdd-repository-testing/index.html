<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何對Repository做測試? | 點燈坊</title>
  <meta name="author" content="真 OO無双">
  
  <meta name="description" content="使用SQLite In-Memory Database是又快又乾淨的方法">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta name="description" content="使用SQLite In-Memory Database是又快又乾淨的方法">
<meta property="og:type" content="article">
<meta property="og:title" content="如何對Repository做測試?">
<meta property="og:url" content="http://oomusou.io/tdd/tdd-repository-testing/index.html">
<meta property="og:site_name" content="點燈坊">
<meta property="og:description" content="使用SQLite In-Memory Database是又快又乾淨的方法">
<meta property="og:image" content="http://oomusou.io/images/feature/logo.png">
<meta property="og:updated_time" content="2016-03-22T14:03:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何對Repository做測試?">
<meta name="twitter:description" content="使用SQLite In-Memory Database是又快又乾淨的方法">
 

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">點燈坊</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 
	
		<div class="page-header">		
			<h1> 如何對Repository做測試?</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

	
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> 使用SQLite In-Memory Database是又快又乾淨的方法			
		</div> <!-- alert -->
		

	<!-- toc -->
	<div id="postTOC">
		<span class="tocHeading">Contents</span>
		<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Version"><span class="toc-article-text">Version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#緣起"><span class="toc-article-text">緣起</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Repository_Pattern"><span class="toc-article-text">Repository Pattern</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#建立Model與Migration"><span class="toc-article-text">建立Model與Migration</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#建立Model_Factory"><span class="toc-article-text">建立Model Factory</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#新增SQLite_In-Memory_Database連線"><span class="toc-article-text">新增SQLite In-Memory Database連線</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#測試Model"><span class="toc-article-text">測試Model</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#建立Unit_Test"><span class="toc-article-text">建立Unit Test</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#建立setUp()與tearDown()"><span class="toc-article-text">建立setUp()與tearDown()</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立待測物件"><span class="toc-article-text">建立待測物件</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#複寫方法"><span class="toc-article-text">複寫方法</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#新增連線測試"><span class="toc-article-text">新增連線測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#執行測試"><span class="toc-article-text">執行測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#新增寫入測試"><span class="toc-article-text">新增寫入測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#執行測試-1"><span class="toc-article-text">執行測試</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#測試Repository"><span class="toc-article-text">測試Repository</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#建立Unit_Test-1"><span class="toc-article-text">建立Unit Test</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#建立setUp()與tearDown()-1"><span class="toc-article-text">建立setUp()與tearDown()</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#新增抓最新3筆文章測試"><span class="toc-article-text">新增抓最新3筆文章測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#執行測試-2"><span class="toc-article-text">執行測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#實作PostRepository"><span class="toc-article-text">實作PostRepository</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立目錄"><span class="toc-article-text">建立目錄</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立類別"><span class="toc-article-text">建立類別</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#引用命名空間"><span class="toc-article-text">引用命名空間</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#執行測試-3"><span class="toc-article-text">執行測試</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#實作getLatest3Posts()"><span class="toc-article-text">實作getLatest3Posts()</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立相依變數"><span class="toc-article-text">建立相依變數</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立PHPDoc"><span class="toc-article-text">建立PHPDoc</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#引入命名空間"><span class="toc-article-text">引入命名空間</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立建構函式"><span class="toc-article-text">建立建構函式</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立實作方法"><span class="toc-article-text">建立實作方法</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#建立PHPDoc-1"><span class="toc-article-text">建立PHPDoc</span></a></li><li class="toc-article-item toc-article-level-4"><a class="toc-article-link" href="#引入命名空間-1"><span class="toc-article-text">引入命名空間</span></a></li></ol></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#執行測試-4"><span class="toc-article-text">執行測試</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Conclusion"><span class="toc-article-text">Conclusion</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Sample_Code"><span class="toc-article-text">Sample Code</span></a></li></ol>
    </div>

	<!-- content -->
	<div class="mypage">		
	    <p>一般我們會把<code>資料庫邏輯</code>寫在repository，只要有<code>邏輯</code>，就需要去寫<code>測試</code>，畢竟我們寫的程式，可能跟我們想的不一樣。由於repository主要目的就是在<code>讀寫資料庫</code>，所以勢必要<code>真的</code>去讀寫資料庫，而不能靠<code>mock</code>，但若真的去讀寫MySQL，速度會比較慢，且可能本來就有一些測試資料，因此會違反<strong>FIRST</strong>原則的<strong>Fast</strong>與<strong>Independent</strong>，比較理想的方式是測試時改去讀寫<a href="https://www.sqlite.org/inmemorydb.html" target="_blank" rel="external">SQLite In-Memory Database</a>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>OS X 10.11.1<br>Laravel 5.1.22<br>PHPUnit 4.8.16<br>PhpStorm 10.0</p>
<h2 id="緣起">緣起</h2><hr>
<p>本文是練習<a href="http://jaceju.net/" target="_blank" rel="external">大澤木小鐵</a>的<a href="https://gist.github.com/jaceju/c415c1b42daf4c589f2a" target="_blank" rel="external">Laravel 5測試起手式</a>的心得筆記，該文詳細的介紹Laravel 5在寫測試時的實戰細節，實用度非常的高。本文是寫給自己看的，順便整理出PhpStorm搭配TDD的實務流程。</p>
<h2 id="Repository_Pattern">Repository Pattern</h2><hr>
<p>初學者常會將<code>商業邏輯</code>與<code>資料庫邏輯</code>同時寫在controller內，如我們想將最新的3筆文章顯示在view。<br><figure class="highlight php"><figcaption><span>app/Http/Controllers/PostsController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostsController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$posts</span> = Post::query()</span><br><span class="line">            -&gt;orderBy(<span class="string">'id'</span>, <span class="string">'desc'</span>)</span><br><span class="line">            -&gt;limit(<span class="number">3</span>)</span><br><span class="line">            -&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = compact(<span class="variable">$posts</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> View(<span class="string">'posts.index'</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>這段code在執行上沒有問題，但在設計上有幾個問題 : </p>
<ol>
<li>由於controller內直接使用Eloquent ORM，表示controller直接相依於<code>Post</code> model，若我們要對controller執行unit test，必須直接存取資料庫，這違反了isolated test原則，且測試時直接存取資料庫，測試速度會慢很多，也違反了<strong>FIRST</strong>原則的<strong>Fast</strong>。</li>
<li><strong>SOLID</strong>的第一條 : <code>單一職責原則</code><strong>SRP (Single Responsibility Principle)</strong>，也就是所謂的<code>關注點分離</code> <strong>(Seperation of Concern)</strong>，controller原本該有的職責應該是<code>商業邏輯</code>，但現在卻將<code>資料庫邏輯</code>直接寫在controller內，這已經超出原本controller的職責，將會導致日後controller過於肥大而難以維護。</li>
<li>將<code>資料庫邏輯</code>直接寫在controller內，將來若有不同controller使用相同的<code>資料庫邏輯</code>，將無法<code>重複使用</code>。</li>
<li>為了isolated test，我們會希望mock掉<code>資料庫邏輯</code>，然後透過DI將mock物件注入contoller，但在controller直接使用model，導致unit test無法使用DI，因此無法執行unit test。</li>
</ol>
<p>比較好的方式是將<code>資料庫邏輯</code>從controller中decouple出來成repository，透過DI將repository注入controller，也就是從原本的3層的MVC架構變成4層的model、repository、controller、view架構。<br><img src="/images/tdd/tdd-repository-testing/repos004.svg" width="600"></p>
<p>使用repository pattern有以下好處 : </p>
<ol>
<li>controller不再直接相依於model，而是透過DI將repository注入controller，符合<strong>DIP</strong>，且測試時不用直接存取資料庫，達到isolated test要求，且測試速度更快。</li>
<li>controller專心負責<code>商業邏輯</code>，repository專心負責<code>資料庫邏輯</code>，符合<strong>SRP</strong>，可避免controller過於肥大而難以維護。</li>
<li><code>資料庫邏輯</code>從controller搬到repository，因此不同的controller可以重複使用。</li>
<li>unit test時可以mock掉repository，透過DI將repository注入controller，因此可實現unit test。</li>
</ol>
<p>將<code>資料庫邏輯</code>從controller搬到repository之後，雖然controller的unit test可以不用存取資料庫，專心測試<code>商業邏輯</code>，但<code>資料庫邏輯</code>還是得測試啊，本文先專心探討如何測試repository的<code>資料庫邏輯</code>。</p>
<h2 id="建立Model與Migration">建立Model與Migration</h2><hr>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan make:model Post -m</span><br></pre></td></tr></table></figure>
<p>建立<code>Post</code> model與migration，<code>-m</code>為Laravel 5.1之後新增的參數，讓我們在建立model時一併建立migrarion。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Model created successfully.&#10;Created Migration: 2015_10_14_113810_create_posts_table</span><br></pre></td></tr></table></figure>
<p>會在<code>app</code>目錄下建立<code>Post.php</code>，並在<code>database/migrations</code>目錄建立migration檔。</p>
<figure class="highlight php"><figcaption><span>app/Post.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [<span class="string">'title'</span>, <span class="string">'sub_title'</span>, <span class="string">'content'</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p>第7行<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected <span class="variable">$fillable</span> = [<span class="string">'title'</span>, <span class="string">'sub_title'</span>, <span class="string">'content'</span>];</span><br></pre></td></tr></table></figure></p>
<p>定義當使用<code>__construct($data)</code>或<code>create($data)</code>時可以被修改的欄位，進而保護其他欄位不被修改。<br><figure class="highlight php"><figcaption><span>database/migrations/2015_10_14_113810_create_posts_table.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreatePostsTable</span> <span class="keyword">extends</span> <span class="title">Migration</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Run the migrations.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Schema::create(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint <span class="variable">$table</span>)</span> </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">'title'</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">'sub_title'</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;text(<span class="string">'content'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Reverse the migrations.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">'posts'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> </p>
<p>13行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">'posts'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(Blueprint <span class="variable">$table</span>)</span> </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;increments(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$table</span>-&gt;string(<span class="string">'title'</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;string(<span class="string">'sub_title'</span>);</span><br><span class="line">    <span class="variable">$table</span>-&gt;text(<span class="string">'content'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>加入<code>title</code>、<code>sub_title</code>與<code>content</code>3個欄位。 </p>
<h2 id="建立Model_Factory">建立Model Factory</h2><hr>
<p>Laravel 5.1提出了<code>model factory</code>，直接整合<code>faker</code>，讓我們在seeding與testing時更為方便。</p>
<figure class="highlight php"><figcaption><span>database/factories/ModelFactory.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$factory</span>-&gt;define(App\Post::class,</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="params">(Faker\Generator <span class="variable">$faker</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">'title'</span>     =&gt; <span class="variable">$faker</span>-&gt;sentence,</span><br><span class="line">            <span class="string">'sub_title'</span> =&gt; <span class="variable">$faker</span>-&gt;sentence,</span><br><span class="line">            <span class="string">'content'</span>   =&gt; <span class="variable">$faker</span>-&gt;paragraph</span><br><span class="line">        ];</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure> 
<p><code>$factory-&gt;define()</code>的第1個參數為欲新增model的完整class名稱，第2個參數為一個closure，預設將<code>faker</code>傳入，可以直接在return陣列中使用<code>$faker</code>新增資料。</p>
<p>這樣的優點是unit test時，只需將我們想要測試的資料輸入即可，其他假資料可以靠model factory的faker輸入。</p>
<h2 id="新增SQLite_In-Memory_Database連線">新增SQLite In-Memory Database連線</h2><hr>
<p>因為實際寫入與讀取MySQL速度較慢，所以在做unit test時，會改用SQLite In-Memory Database，速度快很多。</p>
<figure class="highlight php"><figcaption><span>tests/TestCase.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Artisan</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestCase</span> <span class="keyword">extends</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Testing</span>\<span class="title">TestCase</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * The base URL to use while testing the application.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> string</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$baseUrl</span> = <span class="string">'http://localhost'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Creates the application.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> \Illuminate\Foundation\Application</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createApplication</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$app</span> = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/../bootstrap/app.php'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$app</span>-&gt;make(Illuminate\Contracts\Console\Kernel::class)-&gt;bootstrap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$app</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initDatabase</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        config([</span><br><span class="line">            <span class="string">'database.default'</span>            =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">            <span class="string">'database.connections.sqlite'</span> =&gt; [</span><br><span class="line">                <span class="string">'driver'</span>   =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">                <span class="string">'database'</span> =&gt; <span class="string">':memory:'</span>,</span><br><span class="line">                <span class="string">'prefix'</span>   =&gt; <span class="string">''</span>,</span><br><span class="line">            ],</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        Artisan::call(<span class="string">'migrate'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resetDatabase</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        Artisan::call(<span class="string">'migrate:reset'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p>26行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initDatabase</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    config([</span><br><span class="line">        <span class="string">'database.default'</span>            =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">        <span class="string">'database.connections.sqlite'</span> =&gt; [</span><br><span class="line">            <span class="string">'driver'</span>   =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">            <span class="string">'database'</span> =&gt; <span class="string">':memory:'</span>,</span><br><span class="line">            <span class="string">'prefix'</span>   =&gt; <span class="string">''</span>,</span><br><span class="line">        ],</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    Artisan::call(<span class="string">'migrate'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>initDatabase()</code>負責在每個test case執行<code>setUp()</code>時，透過<code>config()</code>設定目前<code>資料庫連線</code>使用<code>SQLite In-Memory Database</code>。<br><div class="alert alert-info"><i class="fa fa-info"></i>  覺得<b>config()</b>所傳入的這個陣列好眼熟嗎？</div></p>
<p>事實上它就是在<code>config/database.php</code> return的那個陣列，只是之前我們都是直接寫在<code>config/database.php</code>裡面，這次是寫在<code>tests/TestCase.php</code>，目的為了不影響原本的資料庫連線設定，只有在<code>測試</code>時才會使用<strong>SQLite In-Memory Database</strong>。</p>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  在Laravel 4.2，須使用Config::set()取代config()。</div>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">initDatabase</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    Config::set(<span class="string">'database.default'</span>, <span class="string">'sqlite'</span>);</span><br><span class="line">    Config::set(<span class="string">'database.connections.sqlite'</span>, [</span><br><span class="line">        <span class="string">'driver'</span>   =&gt; <span class="string">'sqlite'</span>,</span><br><span class="line">        <span class="string">'database'</span> =&gt; <span class="string">':memory:'</span>,</span><br><span class="line">        <span class="string">'prefix'</span>   =&gt; <span class="string">''</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    Artisan::call(<span class="string">'migrate'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最後會使用<code>Artisan::call(&#39;migrate&#39;)</code>，這就相當於我們在命令列執行<code>php artisan migrate</code>一樣，目的在動態執行migration，產生資料庫所需要的欄位。<br><div class="alert alert-info"><i class="fa fa-info"></i>  之前你曾經覺得寫migration沒用，想直接在phpMyAdmin開欄位嗎？</div> </p>
<p>若沒寫migration，就無法在測試時動態對<strong>SQLite In-Memory Database</strong>建立欄位，所以這也算是寫migration的另一個優點。</p>
<p>40行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resetDatabase</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    Artisan::call(<span class="string">'migrate:reset'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>負責每個test case執行<code>之後</code>，將所有的migration rollback，也就是將所有欄位與資料都刪除，讓下一個test case執行時有完全乾淨的環境。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  為什麼我們知道在<b>TestCase</b> class要新增<b>initDatabase()</b>與<b>resetDatabase()</b>呢？</div>
<p>老實說，一開始寫測試時，我們並不會想將這兩個method寫在<code>TestCase</code>裡，而是會寫在每個Test class的<code>setUp()</code>，但因為<code>initDatabase()</code>與<code>resetDatabase()</code>在每個Test class都會用到，因此被<code>重構</code>的<strong>pull members up</strong>放到<code>TestCase</code>class內。也就是說，當你看到很多高手的架構，其實並不是一開始就這樣設計，而是被<code>重構</code>出來的。</p>
<h2 id="測試Model">測試Model</h2><hr>
<h3 id="建立Unit_Test">建立Unit Test</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan make:test PostModelTest</span><br></pre></td></tr></table></figure>
<p>建立<code>PostModelTest</code>，會在<code>test</code>目錄下建立<code>PostModelTest.php</code>，負責測試<code>Post</code> model。<br>當然直接自己手動新增<code>PostModelTest</code>也可以，但使用<code>php artisan make:test</code>會自動幫我們產生class template，且已經幫我們繼承Laravel的<code>TestCase</code>。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test created successfully.</span><br></pre></td></tr></table></figure></p>
<div class="alert alert-info"><i class="fa fa-info"></i>  實務上需要測試Model嗎？</div>
<p>理論上model是不需要測試的，因為model繼承於Laravel的<code>Illuminate\Database\Eloquent\Model</code>，Laravel已經測試過了，我們只是想測試<strong>SQLite In-Memory Database</strong>連線是否正常而已。</p>
<h3 id="建立setUp()與tearDown()">建立setUp()與tearDown()</h3><h4 id="建立待測物件">建立待測物件</h4><p>建立<code>$target</code> property，主要是放unit test時的<code>待測物件</code>，會在<code>setUp()</code>時將<code>待測物件</code>建立。<span class="margin-note-marker"><sup>1</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">1</span>由於<code>PostModelTest</code>目的就是要測試<code>Post</code> model，目的很明確，所以建議直接使用<code>PHPDoc</code>描述<code>$target</code>型別為<code>Post</code>，這樣的優點是往後使用<code>$this-&gt;target</code>時，PhpStorm的<code>Auto Completion</code>會自動顯示<code>Post</code>的method，開發更有效率又可減少typo。</span></span></span><br><figure class="highlight php"><figcaption><span>tests/PostModelTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Post</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostModelTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 待測物件</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> Post</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$target</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="複寫方法">複寫方法</h4><p>Override <code>setUp()</code>與<code>tearDown()</code>。<span class="margin-note-marker"><sup>2</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">2</span>在PhpStorm按<code>ctrl + o</code>，會出現對話框讓你挑選要<code>override</code>的method，選擇<code>setUp()</code>與<code>tearDown()</code>，並勾選<code>Add PHPDoc</code>與<code>Copy from base class</code>，PHPStorm會幫你自動加上<code>parent::method</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos026.png" alt=""></p>
<p><img src="/images/tdd/tdd-repository-testing/repos027.png" alt=""></p>
<figure class="highlight php"><figcaption><span>tests/PostModelTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Setup the test environment.</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@return</span> void</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::setUp();</span><br><span class="line">    <span class="variable">$this</span>-&gt;initDatabase();</span><br><span class="line">    <span class="variable">$this</span>-&gt;target = <span class="keyword">new</span> Post();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一個test case執行開始，會自動執行<code>setUp()</code>，可以用來<code>初始化資料庫</code>，並重新<code>建立待測物件</code>，以免被其他test case影響測試結果。因為<code>PostModelTest</code>繼承於<code>TestCase</code>，所以也有<code>setUp()</code>，不過在此是想直接<code>override</code>掉<code>setUp()</code>，但又想保有原來<code>setUp()</code>的功能，所以先執行<code>parent::setUp()</code>，接著執行<code>initDatabase()</code>，其中<code>initDatabase()</code>已經在parent class的<code>TestCase</code>實作過，之前已經提過，主要在設定<code>SQLite in Memory Database</code>，並重新跑migration。<br>最後建立待測物件於<code>$this-&gt;target</code>。</p>
<figure class="highlight php"><figcaption><span>tests/PostModelTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Clean up the testing environment before the next test.</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@return</span> void</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tearDown</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;resetDatabase();</span><br><span class="line">    <span class="keyword">parent</span>::tearDown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一個test case執行結束，會自動執行<code>tearDown()</code>，可以用來<code>reset資料庫</code>，讓下次測試不會被舊資料干擾。因為<code>PostModelTest</code>繼承於<code>TestCase</code>，所以也有<code>tearDown()</code>，不過在此是想直接<code>override</code>掉<code>tearDown()</code>，但又想保有原來<code>tearDown()</code>的功能，不過會先執行<code>resetDatabase()</code>，最後才執行<code>parent::tearDown()</code>。<br>其中<code>resetDatabase()</code>已經在parent class的<code>TestCase</code>實作，之前已經提過，主要在跑migration reset，將資料庫還原到原始狀態，避免影響下一次test case執行。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  在Laravel 4.2，必須自己在<b>tearDown()</b>下<b>Mockery::close()</b></div>
<p>在Laravel 5.1，<code>Mockery::close()</code>會在<code>Illuminate\Foundation\Testing\TestCase</code>的<code>tearDown()</code>被執行，因此我們不必再自己加<code>Mockery::close()</code>，不過在Laravel 4.2，我們必須自己在<code>tearDown()</code>加<code>Mockery::close()</code>，否則mock不會正常執行。</p>
<h3 id="新增連線測試">新增連線測試</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 測試SQLite in Memory是否連線成功</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@group</span> PostModel</span><br><span class="line"> * <span class="doctag">@group</span> PostModel0</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testConnection</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// arrange</span></span><br><span class="line">    <span class="variable">$expected</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// act</span></span><br><span class="line">    <span class="variable">$actual</span> = <span class="variable">$this</span>-&gt;target-&gt;all();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert</span></span><br><span class="line">    <span class="variable">$this</span>-&gt;assertCount(<span class="variable">$expected</span>, <span class="variable">$actual</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>寫unit test會依照3A原則 : <strong>Arrange</strong>、<strong>Act</strong>、<strong>Assert</strong>。</p>
<ul>
<li><strong>Arrange</strong> : 準備<code>測試資料</code> <code>$fake</code>、<code>待測物件</code> <code>$target</code>，與建立<code>測試期望值</code> <code>$expected</code>。</li>
<li><strong>Act</strong> : 執行待測物件的<code>method</code>，建立<code>實際結果值</code> <code>$actual</code>。</li>
<li><strong>Assert</strong> : 使用PHPUnit的<code>assertXXX()</code>測試<code>$expected</code>與<code>$actual</code>是否如預期。</li>
</ul>
<p><strong>Arrange</strong><br>目前僅想測試連線，所以還沒有測試資料，只需建立<code>$expected</code>即可，因為還沒有在<code>posts</code>塞任何資料，所以預期資料筆數<code>$expected</code>為<code>0</code>。</p>
<p><strong>Act</strong><br>實際執行<code>$target</code>的<code>all()</code>，這是Eloquent ORM內建的method，一定不會錯，但這裡並不是要測試Eloquent ORM的<code>all()</code>，只是想測試<strong>SQLite In-Memory Database</strong>是否有連線成功，將<code>all()</code>結果存入<code>$actual</code>。</p>
<p><strong>Assert</strong><br>使用PHPUnit的<code>assertCount()</code>，判斷<code>$expected</code>與<code>$actual</code>是否相等，若相等則<code>綠燈</code>，不相等則<code>紅燈</code>。<span class="margin-note-marker"><sup>3</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">3</span><code>assertCount()</code>的<code>$actual</code>可以傳入<code>Array</code>，也可以傳入<code>Collection</code>，主要用於對<code>Array</code>或<code>Collection</code>的資料筆數做assertion。</span></span></span></p>
<div class="alert alert-info"><i class="fa fa-info"></i>  可以自己寫<b>if else</b>來寫測試嗎？</div>
<p>這裡當然可以自己用PHP寫 <code>if ($expected == $actual)</code>判斷，不過因為牽涉到人為的邏輯判斷，當測試錯誤時，很難確定到底是測試有問題，還是我們自己寫的PHP邏輯有問題，所以在測試中<code>不應該</code>寫邏輯，而<code>應該</code>使用PHPUnit的<code>assertion</code>，因為PHPUnit已經被<code>測試過</code>了，當測試結果有錯時，不用再懷疑是不是unit test寫錯，一定是我們的production code寫錯了。</p>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  在PHPDoc可以加上<b>@group</b>，PHPUnit允許我們將test case加以分組測試，而不用每次都跑全部的test case，只跑我們想測試的group即可。</div>
<h3 id="執行測試">執行測試</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ vendor/bin/phpunit</span><br></pre></td></tr></table></figure>
<p>若看到以下畫面，表示<code>SQLite In-Memory Database</code>連線已經成功。<span class="margin-note-marker"><sup>4</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">4</span>明明我們目前只寫了1個測試，為什麼會有<code>2 tests</code>呢？因為Laravel在<code>tests/ExampleTest.php</code>已經自帶一個測試了。</span></span></span></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHPUnit 4.8.16 by Sebastian Bergmann and contributors.&#10;&#10;..&#10;&#10;Time: 188 ms, Memory: 17.50Mb&#10;&#10;OK (1 tests, 1 assertions)</span><br></pre></td></tr></table></figure>
<p>既然<code>SQLite In-Memory Database</code>已經連線成功，之後就可以使用<code>存檔即測試</code>的TDD開發方式。<span class="margin-note-marker"><sup>5</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">5</span><code>存檔即測試</code> : 請參考<a href="/laravel/elixir/elixir-phpunit/">如何在Homestead自動執行測試？</a></span></span></span></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ gulp tdd</span><br></pre></td></tr></table></figure>
<p>若看到以下畫面，表示Laravel Elixir已經正常啟動，將來就能<code>存檔即測試</code>。</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10</span>:<span class="number">08</span>:<span class="number">38</span>] <span class="name">Using</span> <span class="atom">gulpfile</span> ~/<span class="name">MyProject</span>/<span class="atom">gulpfile</span>.<span class="atom">js</span></span><br><span class="line">[<span class="number">10</span>:<span class="number">08</span>:<span class="number">38</span>] <span class="name">Starting</span> <span class="string">'tdd'</span>...</span><br><span class="line"><span class="name">Watching</span> <span class="atom">for</span> <span class="atom">tests</span>...</span><br><span class="line">[<span class="number">10</span>:<span class="number">08</span>:<span class="number">38</span>] <span class="name">Finished</span> <span class="string">'tdd'</span> <span class="atom">after</span> <span class="number">18</span> <span class="atom">ms</span></span><br></pre></td></tr></table></figure>
<h3 id="新增寫入測試">新增寫入測試</h3><p>之前已經測試了對<strong>SQLite In-Memory Database</strong>連線，在此想在補一個<code>寫入測試</code>。<span class="margin-note-marker"><sup>6</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">6</span>實務上可以省略對model的寫入測試，只需確認連線成功即可。</span></span></span></p>
<figure class="highlight php"><figcaption><span>tests/PostModelTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 測試SQLite in Memory是否寫入成功</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@group</span> PostModel</span><br><span class="line"> * <span class="doctag">@group</span> PostModel1</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testCreateAndList</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// Arrange</span></span><br><span class="line">    <span class="variable">$expected</span> = [</span><br><span class="line">        <span class="string">'title'</span> =&gt; <span class="string">'My title'</span>,</span><br><span class="line">    ];</span><br><span class="line">    factory(App\Post::class)-&gt;create(<span class="variable">$expected</span>);</span><br><span class="line">    <span class="variable">$expectedCount</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Act</span></span><br><span class="line">    <span class="variable">$posts</span> = <span class="variable">$this</span>-&gt;target-&gt;all();</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// Assert</span></span><br><span class="line">    <span class="variable">$this</span>-&gt;assertCount(<span class="variable">$expectedCount</span>, <span class="variable">$posts</span>);</span><br><span class="line">    <span class="variable">$this</span>-&gt;seeInDatabase(<span class="string">'posts'</span>, <span class="variable">$expected</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Arrange</strong><br>準備1筆資料新增至<strong>SQLite In-Memory Database</strong>，測試期望值<code>$expected</code>為該筆資料的<code>title</code>欄位與值。<br>使用<code>model factory</code>新增資料，由於我們只準備了部分欄位資料新增，將<code>$expected</code>透過<code>create()</code>傳入。<br>另外新增了<code>$expectedCount=1</code>，期望測試新增了<code>1</code>筆資料。</p>
<p><strong>Act</strong><br>實際執行<code>$target</code>的<code>all()</code>，這是Eloquent ORM內建的method，一定不會錯，但這裡並不是要測試Eloquent ORM的<code>all()</code>，只是想測試<code>SQLite In-Memory Database</code>是否有真的寫入資料，將<code>all()</code>結果存入<code>$actual</code>。</p>
<p><strong>Assert</strong><br>使用PHPUnit的<code>assertCount()</code>，判斷是否新增了一筆資料。<br>Laravel 5.1另外提供了<code>seeInDatabase()</code>，讓我們快速測試某一筆資料的部分欄位資料是否在指定table中。<span class="margin-note-marker"><sup>7</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">7</span>在一個test case執行兩個assertion是否違反unit test<code>一次只測一件事情</code>的原則呢？實務上常會使用2個以上的assertion去<code>測試同一件事情</code>，最典型的就是搭配<code>assertCount()</code>與其他assertion，但只要目的是測同一件事情即可。</span></span></span></p>
<h3 id="執行測試-1">執行測試</h3><p>存檔後，在Mac的右上角會馬上顯示測試結果是<code>綠燈</code>還是<code>紅燈</code>。<br><img src="/images/tdd/tdd-repository-testing/repos000.png" alt=""></p>
<p>完整的<code>PostModelTest.php</code>如下所示 :<br><figure class="highlight php"><figcaption><span>tests/PostModelTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostModelTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 待測物件</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> Post</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$target</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Setup the test environment.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::setUp();</span><br><span class="line">        <span class="variable">$this</span>-&gt;initDatabase();</span><br><span class="line">        <span class="variable">$this</span>-&gt;target = <span class="keyword">new</span> Post();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Clean up the testing environment before the next test.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tearDown</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;resetDatabase();</span><br><span class="line">        <span class="keyword">parent</span>::tearDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 測試SQLite in Memory是否連線成功</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@group</span> PostModel</span><br><span class="line">     * <span class="doctag">@group</span> PostModel0</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testConnection</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        <span class="variable">$expected</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="variable">$actual</span> = <span class="variable">$this</span>-&gt;target-&gt;all();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">        <span class="variable">$this</span>-&gt;assertCount(<span class="variable">$expected</span>, <span class="variable">$actual</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 測試SQLite in Memory是否寫入成功</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@group</span> PostModel</span><br><span class="line">     * <span class="doctag">@group</span> PostModel1</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testCreateAndList</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        <span class="variable">$expected</span> = [</span><br><span class="line">            <span class="string">'title'</span> =&gt; <span class="string">'My title'</span>,</span><br><span class="line">        ];</span><br><span class="line">        factory(App\Post::class)-&gt;create(<span class="variable">$expected</span>);</span><br><span class="line">        <span class="variable">$expectedCount</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="variable">$posts</span> = <span class="variable">$this</span>-&gt;target-&gt;all();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">        <span class="variable">$this</span>-&gt;assertCount(<span class="variable">$expectedCount</span>, <span class="variable">$posts</span>);</span><br><span class="line">        <span class="variable">$this</span>-&gt;seeInDatabase(<span class="string">'posts'</span>, <span class="variable">$expected</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="測試Repository">測試Repository</h2><hr>
<p>重頭戲來了，之前只是在測試對<code>SQLite In-Memory Database</code>連線，現在要開始幫repository寫unit test了。</p>
<h3 id="建立Unit_Test-1">建立Unit Test</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan make:test PostRepositoryTest</span><br></pre></td></tr></table></figure>
<p>建立<code>PostRepositoryTest</code>，會在<code>test</code>目錄下建立<code>PostRepositoryTest.php</code>，負責測試<code>PostRepository</code>。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test created successfully.</span><br></pre></td></tr></table></figure></p>
<h3 id="建立setUp()與tearDown()-1">建立setUp()與tearDown()</h3><figure class="highlight php"><figcaption><span>tests/PostRepositoryTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">PostRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostRepositoryTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 待測物件</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> PostRepository</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$target</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Setup the test environment.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::setUp();</span><br><span class="line">        <span class="variable">$this</span>-&gt;initDatabase();</span><br><span class="line">        <span class="variable">$this</span>-&gt;target = <span class="variable">$this</span>-&gt;app-&gt;make(PostRepository::class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Clean up the testing environment before the next test.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tearDown</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;resetDatabase();</span><br><span class="line">        <span class="variable">$this</span>-&gt;target = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">parent</span>::tearDown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p>13行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Setup the test environment.</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@return</span> void</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::setUp();</span><br><span class="line">    <span class="variable">$this</span>-&gt;initDatabase();</span><br><span class="line">    <span class="variable">$this</span>-&gt;target = <span class="variable">$this</span>-&gt;app-&gt;make(PostRepository::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>與之前的<code>PostModelTest.php</code>一樣，在<code>setUp()</code>初始化資料庫與建立待測物件，唯一的差異在於在此使用<code>service container</code>來建立<code>PostRepository</code>物件，而不是自己去<code>new PostRepository</code>物件。<span class="margin-note-marker"><sup>8</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">8</span><code>setUp()</code>一樣可以使用PhpStorm的<code>ctrl + o</code>方式產生<code>override</code>的<code>setUp()</code>。</span></span></span></p>
<div class="alert alert-info"><i class="fa fa-info"></i>  為什麼要使用<b>$this->app->make()</b>來建立待測物件？</div>
<p>這裡當然也可以自己去<code>new PostRepository</code>物件，不使用<code>service container</code>，不過由於將來<code>PostRepository</code>會相依於<code>Post</code> model，根據<strong>SOLID</strong>的<strong>依賴反轉原則</strong>，我們將來會使用<strong>依賴注入</strong>的方式將<code>Post</code> model注入到<code>PostRepository</code>，若使用<code>new</code>的方式，要寫成<code>$this-&gt;target = new PostRepository(new Post());</code>，且一旦<code>PostRepository</code>增加新的相依物件，unit test就得修改，所以比較理想的方法是所有的<code>物件相依</code>完全交給Laravel的<code>service container</code>去管理，所以要將<code>new</code>改成<code>Application</code>物件的<code>make()</code>。</p>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  可以使用<b>App::make()</b>寫法嗎？</div>
<p>當然也可以使用Laravel 4.2的Facade寫法 : 以<code>App::make()</code>取代<code>$this-&gt;app-&gt;make()</code>，不過Facade寫法嚴格來說不夠物件導向，也不好測試，還必須使用<code>_ide_helper.php</code>才能讓PhpStorm順利執行Code Completion，所以Laravel 5之後已經改用DI的方式，在<code>Illuminate\Foundation\Testing\TestCase</code>的<code>setUp()</code>對<code>TestCase</code>注入<code>Application</code>物件，因此建議改用<code>$this-&gt;app</code>的方式存取<code>Application</code>物件，而不建議使用Facade。</p>
<h3 id="新增抓最新3筆文章測試">新增抓最新3筆文章測試</h3><p><strong>TDD</strong>要我們<code>先寫測試再寫程式</code>，我們想在<code>PostRepository</code>實作<code>抓最新的3筆文章</code>前， 需先想好test case，並將其測試先寫好。</p>
<figure class="highlight php"><figcaption><span>tests/PostRepositoryTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 測試傳回最新3筆文章</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@group</span> PostRepository</span><br><span class="line"> * <span class="doctag">@group</span> PostRepository0</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testGetLatest3Posts</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// Arrange</span></span><br><span class="line">    factory(App\Post::class, <span class="number">100</span>)-&gt;create();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$expected</span> = <span class="keyword">new</span> Collection([</span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="number">99</span>,</span><br><span class="line">        <span class="number">98</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Act</span></span><br><span class="line">    <span class="variable">$actual</span> = <span class="variable">$this</span>-&gt;target</span><br><span class="line">        -&gt;getLatest3Posts()</span><br><span class="line">        -&gt;pluck(<span class="string">'id'</span>); <span class="comment">// 只取[id]欄位的collection</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Assert</span></span><br><span class="line">    <span class="variable">$this</span>-&gt;assertEquals(<span class="variable">$expected</span>, <span class="variable">$actual</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<p><strong>Arrange</strong><br>負責建立要測試的資料，因為我們想要<code>抓最新3筆文章</code>，所以先新增100筆測試資料寫進<strong>SQLite In-Memory Database</strong>，這裡使用了<code>model factory</code>直接新增100筆<code>假資料</code>，不需使用迴圈。</p>
<p>建立<code>$expected</code>，也就我們預期會傳回<code>最新3筆文章</code>的結果，因為要測試的重點在於<code>最新3筆</code>文章，其他欄位如<code>title</code>、<code>sub_title</code>與<code>content</code>因為都是使用<code>faker</code>建立，無法測試，所以我們只在乎<code>id</code>欄位是否如我們預期。</p>
<p><strong>Act</strong><br>實際執行<code>$target</code>的<code>getLatest3Posts()</code>，由於我們只想測試<code>id</code>欄位的值，所以使用<code>pluck()</code>只傳回<code>id</code>欄位的資料進<code>$actual</code>。<span class="margin-note-marker"><sup>9</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">9</span>因為我們還沒實作<code>PostRepository</code> class，所以<code>PostRepository</code>與<code>getLatest3Posts()</code>在PhpStorm是反白，我們將在TDD第一個<code>紅燈</code>之後，再建立此class與method。</span></span></span></p>
<p><strong>Assert</strong><br>使用PHPUnit的<code>assertEquals()</code>，判斷<code>$expected</code>與<code>$actual</code>是否相等，若相等則<code>綠燈</code>，不相等則<code>紅燈</code>。</p>
<h3 id="執行測試-2">執行測試</h3><p>存檔後，在Mac的右上角會馬上顯示測試結果是<code>綠燈</code>還是<code>紅燈</code>。<br>結果是<code>紅燈</code>，測試失敗。＠＠<br><img src="/images/tdd/tdd-repository-testing/repos001.png" alt=""></p>
<p>一旦測試錯誤，就要回去terminal看錯誤訊息。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP Fatal error:  Class &#39;App\Repositories\PostRepository&#39; not found in /Users/oomusou/Code/Demo/Laravel51RepositoryTesting_demo/tests/PostRepositoryTest.php on line 24</span><br></pre></td></tr></table></figure></p>
<p>PHPUnit告訴我們找不到<code>PostRepository</code>，因為我們剛剛只是寫了<code>PostRepositoryTest</code>而已，還沒寫<code>PostRepository</code>，所以當然測試失敗。</p>
<p>這就是<strong>TDD</strong>的精神，<code>要先得到第一個紅燈</code>，代表我們已經先寫好<code>unit test</code>。</p>
<p>完整的<code>PostRepositoryTest</code>如下所示 :<br><figure class="highlight php"><figcaption><span>tests/PostRepositoryTest.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">PostRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostRepositoryTest</span> <span class="keyword">extends</span> <span class="title">TestCase</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 待測物件</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> PostRepository</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$target</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Setup the test environment.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setUp</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::setUp();</span><br><span class="line">        <span class="variable">$this</span>-&gt;initDatabase();</span><br><span class="line">        <span class="variable">$this</span>-&gt;target = <span class="variable">$this</span>-&gt;app-&gt;make(PostRepository::class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Clean up the testing environment before the next test.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tearDown</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;resetDatabase();</span><br><span class="line">        <span class="variable">$this</span>-&gt;target = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">parent</span>::tearDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 測試傳回最新3筆文章</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@group</span> PostRepository</span><br><span class="line">     * <span class="doctag">@group</span> PostRepository0</span><br><span class="line">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testGetLatest3Posts</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// Arrange</span></span><br><span class="line">        factory(App\Post::class, <span class="number">100</span>)-&gt;create();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expected</span> = <span class="keyword">new</span> Collection([</span><br><span class="line">                <span class="number">100</span>,</span><br><span class="line">                <span class="number">99</span>,</span><br><span class="line">                <span class="number">98</span>,</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Act</span></span><br><span class="line">        <span class="variable">$actual</span> = <span class="variable">$this</span>-&gt;target</span><br><span class="line">            -&gt;getLatest3Posts()</span><br><span class="line">            -&gt;pluck(<span class="string">'id'</span>); <span class="comment">// 只取[id]欄位的collection</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Assert</span></span><br><span class="line">        <span class="variable">$this</span>-&gt;assertEquals(<span class="variable">$expected</span>, <span class="variable">$actual</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> </p>
<h3 id="實作PostRepository">實作PostRepository</h3><h4 id="建立目錄">建立目錄</h4><p>在<code>app</code>目錄下建立<code>Repositories</code>目錄。<span class="margin-note-marker"><sup>10</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">10</span>在PhpStorm選擇<code>app</code>目錄，按<code>ctrl + n</code>，<code>New Directory</code></span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos005.png" alt=""></p>
<p><img src="/images/tdd/tdd-repository-testing/repos006.png" alt=""></p>
<h4 id="建立類別">建立類別</h4><p>建立<code>PostRepository</code> class<span class="margin-note-marker"><sup>11</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">11</span>在PhpStorm將滑鼠游標放在反白的<code>PostRepository</code> class上，按<code>alt + enter</code>，顯示<code>Create class</code>，按下建立class。</span></span></span><br><img src="/images/tdd/tdd-repository-testing/repos007.png" alt=""></p>
<p>選擇<code>PostRepository</code>所在的<code>app/Repositories</code>目錄，PhpStorm會自動幫你加上正確的namespace。<span class="margin-note-marker"><sup>12</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">12</span>不過因為Laravel 5.1的<code>app</code>目錄為小寫，所以預設namespace為小寫<code>app</code>，需手動改成大寫<code>App</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos008.png" alt=""></p>
<figure class="highlight php"><figcaption><span>app/Repositories/PostRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostRepository</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> 
<h4 id="引用命名空間">引用命名空間</h4><p>在<code>PostRepositoryTest.php</code>引入<code>App\Repositories\PostRepository</code> namespace。<span class="margin-note-marker"><sup>13</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">13</span>在PhpStorm將滑鼠游標放在反白的<code>PostRepository</code>上，按<code>alt + enter</code>，顯示<code>Import class</code>，按下建立using namespace。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos009.png" alt=""></p>
<p>自動引入了<code>App\Repositories\PostRepository</code>。<br><img src="/images/tdd/tdd-repository-testing/repos010.png" alt=""></p>
<h3 id="執行測試-3">執行測試</h3><p>存檔後還是<code>紅燈</code>，測試失敗。＠＠<br><img src="/images/tdd/tdd-repository-testing/repos002.png" alt=""></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP Fatal error:  Call to undefined method App\Repositories\PostRepository::getLatest3Posts() in /Users/oomusou/Code/Demo/Laravel51RepositoryTesting_demo/tests/PostRepositoryTest.php on line 61</span><br></pre></td></tr></table></figure>
<p>PHPUnit告訴我們找不到<code>getLatest3Posts()</code>，因為我們剛剛只建立了<code>PostRepository</code>而已，還沒建立<code>getLast3Posts()</code>，所以當然測試失敗。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  不要因為在unit test時看到<b>紅燈</b>而沮喪！！</div>
<p>事實上TDD的開發流程本來就是先有<code>紅燈</code>才去寫production code，這也是TDD能解決<code>over design</code>的關鍵，因為test case的<code>紅燈</code>來自於<code>需求</code>，由<code>紅燈</code>變成<code>綠燈</code>就是<code>解決需求</code>，若沒有<code>紅燈</code>而直接<code>綠燈</code>，就表示之前的production code有<code>over design</code>。</p>
<h3 id="實作getLatest3Posts()">實作getLatest3Posts()</h3><h4 id="建立相依變數">建立相依變數</h4><p>建立<code>$post</code> property。<span class="margin-note-marker"><sup>14</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">14</span>在PhpStorm中只要輸入要注入的<code>protected $post;</code>變數即可。按下<code>ctrl + n</code>，建立<code>PHPDoc Blocks...</code>。</span></span></span><br><img src="/images/tdd/tdd-repository-testing/repos011.png" alt=""></p>
<h4 id="建立PHPDoc">建立PHPDoc</h4><p>選擇要建立<code>PHPDoc</code>的變數<code>post</code>。<br><img src="/images/tdd/tdd-repository-testing/repos012.png" alt=""></p>
<p>加上變數<code>$post</code>的型別描述<code>Post</code>。<span class="margin-note-marker"><sup>15</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">15</span>加上型別描述後，可以幫助PhpStorm的<code>Code Completion</code>，之後可以使用選擇的方式輸入property與method。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos013.png" alt=""></p>
<h4 id="引入命名空間">引入命名空間</h4><p>引入<code>App\Post</code> namespace。<span class="margin-note-marker"><sup>16</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">16</span>在PhpStorm將滑鼠按下最左側的<code>燈泡</code>的下拉選單，顯示<code>Import class</code>，按下建立using namespace。當PhpStorm出現<code>燈泡</code>時，表示有<code>建議動作</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos014.png" alt=""></p>
<p>自動引入了<code>App\Post</code>。<br><img src="/images/tdd/tdd-repository-testing/repos015.png" alt=""></p>
<h4 id="建立建構函式">建立建構函式</h4><p>建立constructor注入<code>Post</code> model。<span class="margin-note-marker"><sup>17</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">17</span>在PhpStorm按<code>ctrl + n</code>，選擇<code>Generate Constructor...</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos016.png" alt=""></p>
<p>選擇要注入constructor的變數。<br><img src="/images/tdd/tdd-repository-testing/repos017.png" alt=""></p>
<p>自動產生constructor。<br><img src="/images/tdd/tdd-repository-testing/repos018.png" alt=""></p>
<h4 id="建立實作方法">建立實作方法</h4><p>回到<code>PostRepositoryTest.php</code>，建立<code>getLatest3Post()</code>。<span class="margin-note-marker"><sup>18</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">18</span>在PhpStorm將滑鼠游標放在反白的<code>getLatest3Posts()</code>上，按<code>alt + enter</code>，顯示<code>Add method</code>，按下建立<code>getLatest3Posts()</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos019.png" alt=""></p>
<p>在<code>PostRepository</code>自動建立了<code>getLatest3Posts()</code>。<br><img src="/images/tdd/tdd-repository-testing/repos020.png" alt=""></p>
<p>使用Eloquent ORM查詢最新3筆文章。<br><figure class="highlight php"><figcaption><span>app/Repositories/PostRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLatest3Posts</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$this</span>-&gt;post</span><br><span class="line">        -&gt;query()</span><br><span class="line">        -&gt;orderBy(<span class="string">'id'</span>, <span class="string">'desc'</span>)</span><br><span class="line">        -&gt;limit(<span class="number">3</span>)</span><br><span class="line">        -&gt;get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> </p>
<p>因為已經將<code>Post</code> model注入至<code>$this-&gt;post</code>，所以可直接使用，而不必再使用<code>Post::query()</code>的<code>Facade</code>方式抓資料。</p>
<h4 id="建立PHPDoc-1">建立PHPDoc</h4><p>建立<code>getLatest3Posts</code>的<code>PHPDoc Block</code>。<span class="margin-note-marker"><sup>19</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">19</span>在PhpStorm按<code>ctrl + n</code>，選擇<code>Generate PHPDoc Blocks...</code>，為property與method寫<code>PHPDoc Block</code>，可以幫助PhpStorm的<code>Code Completion</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos021.png" alt=""></p>
<p>選擇要建立<code>PHPDoc Block</code>的<code>getLatest3Posts</code>。<br><img src="/images/tdd/tdd-repository-testing/repos022.png" alt=""></p>
<p>建立了<code>PHPDoc Block</code>，加上註釋，並將回傳型別改成<code>Collection</code>，此時<code>Collection</code>會出現反白，因為還未引入namespace。<br><img src="/images/tdd/tdd-repository-testing/repos023.png" alt=""></p>
<h4 id="引入命名空間-1">引入命名空間</h4><p>引入<code>Collection</code> namespace。<span class="margin-note-marker"><sup>20</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">20</span>在PhpStorm將滑鼠按下最左側的<code>燈泡</code>的下拉選單，顯示<code>Import class</code>，按下建立using namespace。當PhpStorm出現<code>燈泡</code>時，表示<code>有建議動作</code>。</span></span></span></p>
<p><img src="/images/tdd/tdd-repository-testing/repos024.png" alt=""></p>
<p>選擇<code>Illuminate\Database\Eloquent\Collection</code>。<br><img src="/images/tdd/tdd-repository-testing/repos025.png" alt=""></p>
<h3 id="執行測試-4">執行測試</h3><p>存檔後變成<code>綠燈</code>，測試成功。<br><img src="/images/tdd/tdd-repository-testing/repos003.png" alt=""></p>
<p>完整的<code>PostRepository</code>如下所示 :<br><figure class="highlight php"><figcaption><span>tests/PostRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Post</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostRepository</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * <span class="doctag">@var</span> Post</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$post</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * PostRepository constructor.</span><br><span class="line">     * <span class="doctag">@param</span> Post $post</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Post <span class="variable">$post</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;post = <span class="variable">$post</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 傳回最新3筆文章</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> Collection</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getLatest3Posts</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;post</span><br><span class="line">            -&gt;query()</span><br><span class="line">            -&gt;orderBy(<span class="string">'id'</span>, <span class="string">'desc'</span>)</span><br><span class="line">            -&gt;limit(<span class="number">3</span>)</span><br><span class="line">            -&gt;get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>TDD的開發流程就是<code>寫測試-&gt;紅燈-&gt;寫程式-&gt;綠燈-&gt;重構-&gt;綠燈-&gt;重構...-&gt;綠燈</code>，所以看到測試<code>紅燈</code>不要怕，只要趕快寫程式讓他<code>綠燈</code>即可。</li>
<li>本文實際結合Laravel與PHPUnit，以TDD方式開發，實際對<strong>SQLite In-Memory Database</strong>做讀寫測試，還搭配Laravel Elixir，實現<code>存檔即測試</code>的目標。</li>
<li>由於TDD是先寫unit test，再寫production code，所以在寫unit test時，已經在思考production code的class與method，配合PhpStorm，可以直接在unit test內新增class與method，還可以自動建立DI constructor與引用namespace，過程非常直覺流暢。</li>
<li>在Laravel寫測試還有很多技巧，其他請參考<a href="http://jaceju.net" target="_blank" rel="external">大澤木小鐵</a>的<a href="https://gist.github.com/jaceju/c415c1b42daf4c589f2a" target="_blank" rel="external">Laravel 5測試起手式</a>，非常經典，本文僅針對repository測試部分做深入探討。</li>
<li>在Laravel 4.2一樣可以使用這種方式做測試，但須注意2點 : <ol>
<li>在<code>initDatabase()</code>時須使用<code>Config::set()</code>設定<code>MySqlite in Memory Database</code>。</li>
<li>在<code>tearDown()</code>須自己手動<code>Mockery::close()</code>。</li>
</ol>
</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的<a href="https://github.com/oomusou/Laravel51RepositoryTesting_demo" target="_blank" rel="external">GitHub</a>上找到。</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/ci/travis-ci-setup/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/tags"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/laravel/elixir/elixir-browsersync/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2015-10-14 
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Laravel/">Laravel<span>24</span></a></li> <li><a href="/tags/PHPUnit/">PHPUnit<span>8</span></a></li> <li><a href="/tags/PhpStorm/">PhpStorm<span>15</span></a></li> <li><a href="/tags/SQLite/">SQLite<span>1</span></a></li> <li><a href="/tags/TDD/">TDD<span>9</span></a></li>
    </ul>
	</div>
		

    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer>  </footer>
</div> <!-- container-narrow -->
  
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hAXbiVYFC92XF16_EhCh','2.0.0');
  </script>



  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
