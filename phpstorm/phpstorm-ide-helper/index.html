<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何在PhpStorm活用PHPDoc? | 點燈坊</title>
  <meta name="author" content="真 OO無双">
  
  <meta name="description" content="利用PHPDoc發揮PhpStorm的威力">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta name="description" content="利用PHPDoc發揮PhpStorm的威力">
<meta property="og:type" content="article">
<meta property="og:title" content="如何在PhpStorm活用PHPDoc?">
<meta property="og:url" content="http://oomusou.io/phpstorm/phpstorm-ide-helper/index.html">
<meta property="og:site_name" content="點燈坊">
<meta property="og:description" content="利用PHPDoc發揮PhpStorm的威力">
<meta property="og:image" content="http://oomusou.io/images/feature/logo.png">
<meta property="og:updated_time" content="2016-04-04T07:58:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="如何在PhpStorm活用PHPDoc?">
<meta name="twitter:description" content="利用PHPDoc發揮PhpStorm的威力">
 

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">點燈坊</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class="fa fa-rss"></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 
	
		<div class="page-header">		
			<h1> 如何在PhpStorm活用PHPDoc?</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div class="col-md-9">
	

	
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> 利用PHPDoc發揮PhpStorm的威力			
		</div> <!-- alert -->
		

	<!-- toc -->
	<div id="postTOC">
		<span class="tocHeading">Contents</span>
		<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Version"><span class="toc-article-text">Version</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#使用PhpStorm開啟Laravel"><span class="toc-article-text">使用PhpStorm開啟Laravel</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Route"><span class="toc-article-text">Route</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Validator"><span class="toc-article-text">Validator</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Schema_Builder"><span class="toc-article-text">Schema Builder</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Laravel_IDE_Helper"><span class="toc-article-text">Laravel IDE Helper</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#安裝"><span class="toc-article-text">安裝</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Service_Provider"><span class="toc-article-text">Service Provider</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#設定檔"><span class="toc-article-text">設定檔</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#資料庫連線"><span class="toc-article-text">資料庫連線</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Facade"><span class="toc-article-text">Facade</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#composer-json"><span class="toc-article-text">composer.json</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Model"><span class="toc-article-text">Model</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Service_Container"><span class="toc-article-text">Service Container</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Laravel_Plugin"><span class="toc-article-text">Laravel Plugin</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#安裝-1"><span class="toc-article-text">安裝</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Controller"><span class="toc-article-text">Controller</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Route-1"><span class="toc-article-text">Route</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#View"><span class="toc-article-text">View</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#config::get()"><span class="toc-article-text">config::get()</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Why_PHPDoc?"><span class="toc-article-text">Why PHPDoc?</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#自己寫的class"><span class="toc-article-text">自己寫的class</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#手動建立PHPDoc"><span class="toc-article-text">手動建立PHPDoc</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Fields"><span class="toc-article-text">Fields</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Method"><span class="toc-article-text">Method</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Overloading"><span class="toc-article-text">Overloading</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Property"><span class="toc-article-text">Property</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Method-1"><span class="toc-article-text">Method</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Collection"><span class="toc-article-text">Collection</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Conclusion"><span class="toc-article-text">Conclusion</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Sample_Code"><span class="toc-article-text">Sample Code</span></a></li></ol>
    </div>

	<!-- content -->
	<div class="mypage">		
	    <p>初學者使用PhpStorm開啟Laravel專案時，馬上會發現原來的程式碼出現一堆反白警告，事實上這些都是有意義的，只是初學者常常不知道怎麼處理，而忽略這些反白警告，除此之外，PhpStorm有強大的語法提示功能，讓你不用去死記物件有哪些field與method，只要用選的即可，可大幅增加開發效率，也不用擔心typo打錯。而PhpStorm威力的背後，就是基於<strong>PHPDoc</strong>。</p>
<a id="more"></a>
<h2 id="Version">Version</h2><hr>
<p>PHP 7.0.0<br>Laravel 5.2.22<br>PhpStorm 10.0.3<br>Laravel IDE Helper 2.1.4</p>
<h2 id="使用PhpStorm開啟Laravel">使用PhpStorm開啟Laravel</h2><hr>
<p>第一次使用PhpStorm開啟Laravel時，原來平靜的程式碼在很多地方都出現了許多反白 :</p>
<h3 id="Route">Route</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide000.png" alt=""></p>
<p>PhpStorm抱怨<code>Route</code>是<code>Undefined class Route</code>。</p>
<h3 id="Validator">Validator</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide001.png" alt=""></p>
<p>在<code>AuthController</code>中，PhpStorm抱怨<code>Validator</code>是<code>Undefined class Validator</code>。</p>
<h3 id="Schema_Builder">Schema Builder</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide002.png" alt=""></p>
<p>在user的migration中，PhpStorm抱怨<code>Schema</code>是<code>Undefined class Schema</code>。</p>
<p>還抱怨了<code>unique()</code>是<code>Method not found</code>。</p>
<p>之所以會如此，root cause有兩個 :</p>
<ol>
<li><code>Route</code>、<code>Validator</code>與<code>Schema</code>使用了Laravel特有的<strong>Facade</strong>機制，導致PhpStorm無法解析。</li>
<li><code>unique()</code>使用了PHP獨有的<strong>Overloading</strong>機制，可以動態產生property與method，也因為是動態產生，所以PhpStorm無法解析。<span class="margin-note-marker"><sup>1</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">1</span>PHP的Overloading與一般物件導向語言所謂的Overloading不同，詳細請參考<a href="/php/php-cs/#Overload">PHP與C#語法快速導覽之Overloading</a></span></span></span></li>
</ol>
<h2 id="Laravel_IDE_Helper">Laravel IDE Helper</h2><hr>
<p>有了問題就要解決，我們先來解決第一個問題 : Laravel特有的Facade機制。</p>
<p><a href="https://github.com/barryvdh/laravel-ide-helper" target="_blank" rel="external">Laravel IDE Helper</a>讓PhpStorm看得懂Laravel Facade，還增加了許多其他的支援。<span class="margin-note-marker"><sup>2</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">2</span>Laravel IDE Helper作者Barry vd. Heuvel的另一個大作<a href="https://github.com/barryvdh/laravel-debugbar" target="_blank" rel="external">Laravel Debugbar</a>，詳細請參考<a href="/laravel/laravel-debugbar/">如何使用Laravel Debugbar?</a></span></span></span></p>
<h3 id="安裝">安裝</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ composer require barryvdh/laravel-ide-helper --dev</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide003.png" alt=""></p>
<p>使用composer安裝Laravel IDE Helper，因為此套件只會在開發使用，可以加上<code>--dev</code>參數。<span class="margin-note-marker"><sup>3</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">3</span>關於<code>--dev</code>參數，詳細請參考<a href="/laravel/laravel-debugbar/#使用Composer安裝">如何使用Laravel Debugbar#使用Composer安裝</a></span></span></span></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ composer require doctrine/dbal --dev</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide007.png" alt=""></p>
<p>Laravel IDE Helper會透過<a href="http://www.doctrine-project.org/projects/dbal.html" target="_blank" rel="external">doctrine/dbal</a>去抓table的schema，替model加上欄位註解。</p>
<h3 id="Service_Provider">Service Provider</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Barryvdh\LaravelIdeHelper\IdeHelperServiceProvider::class,</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide004.png" alt=""></p>
<p>在<code>config/app.php</code>中加入<code>IdeHelperServiceProvider</code>。</p>
<h3 id="設定檔">設定檔</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan vendor:publish --provider=&#34;Barryvdh\LaravelIdeHelper\IdeHelperServiceProvider&#34; --tag=config</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide008.png" alt=""></p>
<p>產生Laravel IDE Helper自己的設定檔，位在<code>config/ide-helper.php</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide009.png" alt=""></p>
<p>建議將<code>include_helpers</code>設定為true，讓Laravel IDE Helper幫我們建立helper function的註解。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide010.png" alt=""></p>
<p>Laravel 5預設將model放在<code>app</code>目錄下，若你有自己的model目錄，請修改此設定。</p>
<h3 id="資料庫連線">資料庫連線</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide015.png" alt=""></p>
<p>有些Facade與資料庫有關，先確定專案已經與資料庫順利連線。</p>
<h3 id="Facade">Facade</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan ide-helper:generate</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide005.png" alt=""></p>
<p>建立Laravel Facade的PHPDoc，產生了<code>_ide_helper.php</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide006.png" alt=""></p>
<p>可以發現在專案根目錄多了<code>_ide_helper.php</code>，我們找到了<code>Route</code> class與<code>get()</code>，發現多加了PHPDoc註解，讓PhpStorm知道<code>get()</code>的參數資訊與回傳型別，這提供了PhpStorm幫我們做語法檢查的根據。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide012.png" alt=""></p>
<p><code>Route</code>不再反白。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide013.png" alt=""></p>
<p><code>Validator</code>也不再反白。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide014.png" alt=""></p>
<p><code>Schema</code>也不再反白，不過<code>unique()</code>還是反白，稍後會解決。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  若將來透過composer update更新Laravel，是否還要重新產生_ide_helper.php呢?</div>
<h3 id="composer-json">composer.json</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>:&#123;</span><br><span class="line">    <span class="string">"post-update-cmd"</span>: [</span><br><span class="line">        <span class="string">"php artisan clear-compiled"</span>,</span><br><span class="line">        <span class="string">"php artisan ide-helper:generate"</span>,</span><br><span class="line">        <span class="string">"php artisan optimize"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide011.png" alt=""></p>
<p>只要在<code>composer.json</code>的<code>post-update-cmd</code>改成如上圖所示，以後只要<code>composer update</code>更新Laravel，就會自動重新建立<code>_ide_helper.php</code>。</p>
<h3 id="Model">Model</h3><p><strong>資料庫欄位名稱</strong>是開發過程的另外一個痛，傳統都要另外一個視窗開著phpMyAdmin或Sequel Pro，一邊查詢資料庫欄位一邊寫程式，若PhpStorm能替我們對model的欄位名稱做<strong>語法提示</strong>，讓我們用選的，那就太好了。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan ide-helper:models</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide016.png" alt=""></p>
<p>Laravel IDE Helper提供兩種方式幫你建立model的PHPDoc，預設是產生一個<code>_ide_helper_models.php</code>，也可以直接將PHPDoc寫在原本的model檔內，我們打<code>yes</code>，選擇直接在model內建立PHPDoc。<span class="margin-note-marker"><sup>4</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">4</span>理論上選擇預設的<code>_ide_helper_models.php</code>也不是問題，不過因為在<code>_ide_helper_models.php</code>也定義了<code>User</code> class，所以在repository內<code>use User</code>時，會出現<code>Multiple definitions for class User</code>的警告，所以才選擇將PHPDoc直接建立在model內。</span></span></span></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide017.png" alt=""></p>
<p>Laravel IDE Helper幫我們替<code>User</code> model建立了PHPDoc : </p>
<ol>
<li>所有的資料庫欄位名稱都加上了<code>@property</code>註解。</li>
<li>所有的資料庫欄位名稱的<code>where</code>都加上了<code>@method</code>註解。<span class="margin-note-marker"><sup>5</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">5</span>這些method都是Eloquent根據資料庫欄位，使用Overloading機制動態產生的method，因此PhpStorm無法自動抓到，必須手動寫PHPDoc的@method</span></span></span></li>
</ol>
<figure class="highlight php"><figcaption><span>app/Repositories/UserRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> User */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserRepository constructor.</span><br><span class="line">     * <span class="doctag">@param</span> User $user</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User <span class="variable">$user</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 回傳第一位User</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> User</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFirstUser</span><span class="params">()</span> : <span class="title">User</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;user-&gt;all()-&gt;first();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>19行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 回傳第一位User</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@return</span> User</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFirstUser</span><span class="params">()</span> : <span class="title">User</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$this</span>-&gt;user-&gt;all()-&gt;first();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我們傳回第一筆<code>User</code> model。</p>
<figure class="highlight php"><figcaption><span>app/Services/UserService.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> UserRepository */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userRepository</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserService constructor.</span><br><span class="line">     * <span class="doctag">@param</span> UserRepository $userRepository</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserRepository <span class="variable">$userRepository</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;userRepository = <span class="variable">$userRepository</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 顯示第一筆user的姓名</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showFirstUser</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="variable">$this</span>-&gt;userRepository-&gt;getFirstUser();</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable">$user</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>19行<br><img src="/images/phpstorm/phpstorm-ide-helper/ide018.png" alt=""></p>
<p>輸入<code>$user</code>後，只要輸入<code>-&gt;</code>，就會出現資料庫欄位名稱讓你挑選，再也不用死記或靠其他工具查詢資料庫欄位名稱了。</p>
<h3 id="Service_Container">Service Container</h3><p>當我們使用service container，利用<code>App::make()</code>建立物件時，由於傳進去的是字串，因此PhpStorm根本不知道我們建立了什麼物件，但透過PhpStorm另外擴充的<strong>PhpStorm Advanced Metadata</strong>機制，讓我們在使用service container時，也能享受語法提示功能。<span class="margin-note-marker"><sup>6</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">6</span>關於PhpStorm Advanced Meta，請參考PhpStorm官網的<a href="https://confluence.jetbrains.com/display/PhpStorm/PhpStorm+Advanced+Metadata" target="_blank" rel="external">PhpStorm Advanced Metadata</a></span></span></span></p>
<p>不過這裡不用擔心，不需要會寫PhpStorm Advanced Metadata，因為Laravel IDE Helper幫大家寫好了。</p>
<p><strong>Strategy Pattern</strong><br><strong>routes.php</strong><span class="margin-note-marker"><sup>7</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">7</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/c9344cdc0264496dc906486ad54a8d384f77d178" target="_blank" rel="external">修改routes.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Http/routes.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/show'</span>, <span class="string">'UserController@show'</span>);</span><br></pre></td></tr></table></figure></p>
<p>在routes.php加上URI與其對應的controller action。</p>
<p><strong>UserController.php</strong><span class="margin-note-marker"><sup>8</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">8</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/bd8024c814dfb1853f3ced6f16ac34cc79661070" target="_blank" rel="external">建立UserController.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Http/Controllers/UserController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">UserService</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> UserService */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userService</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserController constructor.</span><br><span class="line">     * <span class="doctag">@param</span> UserService $userService</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserService <span class="variable">$userService</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;userService = <span class="variable">$userService</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;userService-&gt;show(<span class="string">'admin'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第8行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@var</span> UserService */</span></span><br><span class="line"><span class="keyword">private</span> <span class="variable">$userService</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * UserController constructor.</span><br><span class="line"> * <span class="doctag">@param</span> UserService $userService</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserService <span class="variable">$userService</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;userService = <span class="variable">$userService</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注入<code>UserService</code>。</p>
<p>20行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;userService-&gt;show(<span class="string">'admin'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在<code>show()</code>呼叫<code>$this-&gt;userService</code>的<code>show()</code>，並將<code>admin</code>變數傳入。</p>
<p><strong>AbstractUser.php</strong><span class="margin-note-marker"><sup>9</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">9</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/2ad666a7c9e4ce9a6e1faa429c10a0f6e593d002" target="_blank" rel="external">建立AbstractUser.php</a></span></span></span></p>
<figure class="highlight php"><figcaption><span>app/Services/User/AbstractUser.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractUser</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由<code>abstract class</code>定義<code>show()</code>，如此PhpStorm就能幫我們做語法提示與語法檢查了。</p>
<p><strong>Admin.php</strong><span class="margin-note-marker"><sup>10</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">10</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/28d1caa0ad9d2ad91a515f26ebb9677dc8c0ab3d" target="_blank" rel="external">建立Admin.php</a></span></span></span></p>
<figure class="highlight php"><figcaption><span>app/Services/User/Admin.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span> <span class="keyword">extends</span> <span class="title">AbstractUser</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">'I am a admin'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Admin</code>繼承<code>AbstractUser</code>，因為之前定義了<code>show()</code> abstract method，所以必須在此實作<code>show()</code>。</p>
<p><strong>Customer.php</strong><span class="margin-note-marker"><sup>11</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">11</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainer/commit/3e86bbab2e1e14d3807cbe70d3a25d89cec17ea6" target="_blank" rel="external">建立Customer.php</a></span></span></span></p>
<figure class="highlight php"><figcaption><span>app/Services/User/Customer.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">extends</span> <span class="title">AbstractUser</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">'I am a customer'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Customer</code>繼承<code>AbstractUser</code>，因為之前定義了<code>show()</code> abstract method，所以必須在此實作<code>show()</code>。</p>
<p><strong>UserService.php</strong><span class="margin-note-marker"><sup>12</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">12</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/33b78da6b558e75a8c6791a49563966c6d42f695" target="_blank" rel="external">建立UserService.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/UserService.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">User</span>\<span class="title">AbstractUser</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserService</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(string <span class="variable">$type</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        App::bind(AbstractUser::class, <span class="string">'App\Services\User\\'</span> . ucfirst(<span class="variable">$type</span>));</span><br><span class="line">        App::make(AbstractUser::class)-&gt;show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第10行<br><img src="/images/phpstorm/phpstorm-ide-helper/ide019.png" alt=""></p>
<p>透過<code>App::make()</code>產生的物件，PhpStorm並無法提供語法提示。</p>
<p><strong>產生PhpStorm Advanced Metadata</strong><span class="margin-note-marker"><sup>13</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">13</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/49f49b5a7c51e3a4a5af5c4609a866aa2e850860" target="_blank" rel="external">建立.phpstorm.meta.php</a></span></span></span></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oomusou@mac:~/MyProject$ php artisan ide-helper:meta</span><br></pre></td></tr></table></figure>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide020.png" alt=""></p>
<p>Laravel IDE Helper幫我們建立了PhpStorm Advanced Metadata，檔名為<code>.phpstorm.meta.php</code>。</p>
<p><strong>重新啟動PhpStorm</strong><br><img src="/images/phpstorm/phpstorm-ide-helper/ide021.png" alt=""></p>
<p>有了<code>.phpstorm.meta.php</code>，<code>App::make()</code>就會參考此檔，自動顯示語法提示。<span class="margin-note-marker"><sup>14</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">14</span>在<code>.phpstorm.meta.php</code>中定義了3種方式會啟動語法提示 : <code>ArrayAccess style</code>, <code>App::make()</code>與<code>app()</code>，其中Laravel IDE Helper在該檔中幫我們建立了很多class與interaface的<strong>別名</strong>，讓我們可以用更簡短的名稱使用service container。</span></span></span></p>
<h2 id="Laravel_Plugin">Laravel Plugin</h2><hr>
<p>我們還需要安裝<a href="https://github.com/Haehnchen/idea-php-laravel-plugin" target="_blank" rel="external">Laravel Plugin</a>，它包含了一些Laravel IDE Helper所沒有提供的語法提示功能。</p>
<h3 id="安裝-1">安裝</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide060.png" alt=""></p>
<p><strong><em>PhpStorm -&gt; Preferences -&gt; Plugins</em></strong></p>
<p>輸入<code>Laravel</code>，按<code>Browse</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide061.png" alt=""></p>
<p>選擇<code>Laravel Plugin</code>，按<code>Install</code>安裝。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide062.png" alt=""></p>
<p>安裝完，按<code>Restart PhpStorm</code>重新啟動。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide063.png" alt=""></p>
<p><strong><em>PhpStorm -&gt; Preferences -&gt; Other Settings -&gt; Laravel Plugin</em></strong></p>
<p>將<code>Enable plugin for this project</code>與<code>Use AutoPopop for completion</code>打勾。</p>
<p>再次重新啟動PhpStorm。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  這一步非常重要，很多人安裝完Laravel Plugin後，因為沒有Enable，導致Laravel Plugin從來沒有啟動過。</div>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  Laravel Plugin只要安裝一次即可，不過每次若開新Laravel專案，必須重新enable一次，否則Laravel Plugin不會啟動，這點很容易忽略。</div>
<h3 id="Controller">Controller</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide064.png" alt=""></p>
<p>在<code>routes.php</code>中，已經可以選擇controller與action。</p>
<h3 id="Route-1">Route</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide065.png" alt=""></p>
<p>在blade使用<code>route()</code>時，已經可以抓到在<code>routes.php</code>所定義的route別名。</p>
<h3 id="View">View</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide066.png" alt=""></p>
<p>在controller回傳view時，已經可以抓到在<code>resources/views</code>目錄下所定義的view。</p>
<p>除此之外，在blade中如<code>@include</code>也可以抓到其他blade。</p>
<h3 id="config::get()">config::get()</h3><p><img src="/images/phpstorm/phpstorm-ide-helper/ide067.png" alt=""></p>
<p><code>config::get()</code>已經可以抓到array的key值了。</p>
<h2 id="Why_PHPDoc?">Why PHPDoc?</h2><hr>
<p>Laravel IDE Helper幫我們做了很多事情，讓PHP在PhpStorm可以如強型別語言一樣使用語法提示與語法檢查，但其黑魔法在哪裡呢?</p>
<p>如C#這種強型別語言，Visual Studio之所以能即時提供語法提示與語法檢查，因為當你在Visual Studio寫程式時，C# compiler就在背景默默地編譯，因此可以及時提供語法提示，且及時顯示語法檢查的警告，也因此Visual Studio需要更高檔的硬體支援。</p>
<p>但PHP沒有compiler，必須執行了才知道結果，所以PhpStorm所有的語法檢查與語法提示資訊都來自於PHPDoc，甚至可以說，<code>PhpStorm是在檢查你的PHPDoc，而不是在檢查PHP</code>。</p>
<p>Laravel IDE Helper幫我們做的，就是將Laravel部分的PHPDoc補齊。</p>
<p>接下來要談的，是你自己寫程式的部分，也就是Laravel IDE Helper沒有辦法幫你的部分，必須自己寫PHPDoc。<span class="margin-note-marker"><sup>15</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">15</span>若你對更多的PHPDoc指令有興趣，詳細請參考<a href="/phpstorm/phpstorm-phpdoc/">如何使用PHPDoc寫註解?</a></span></span></span></p>
<h2 id="自己寫的class">自己寫的class</h2><hr>
<h3 id="手動建立PHPDoc">手動建立PHPDoc</h3><ol>
<li><p>在PhpStorm輸入<code>/**</code>，然後按下&#8617;，PhpStorm會自動依據當時的游標的位置產生適當的PHPDoc blocks。</p>
</li>
<li><p>按熱鍵&#8984; + N，會產生<code>Generate</code>選單，選擇<code>PHPDoc Blocks</code>。<br><img src="/images/phpstorm/phpstorm-ide-helper/ide026.png" alt=""></p>
</li>
<li><p>在<code>適當時機</code>按熱鍵&#8997; + &#8617;，會出現<code>Generate PHPDoc for ...</code>。如剛建立完class, property或method時。<br><img src="/images/phpstorm/phpstorm-ide-helper/ide027.png" alt=""></p>
</li>
</ol>
<h3 id="Fields">Fields</h3><p><strong>語法</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@var</span> 型別 [變數名稱] [註解] */</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>型別</strong>可以是PHP原生型別，class，interface或trait。</li>
<li>假如下一行就是該變數，可以省略<strong>變數名稱</strong>。</li>
<li>可選擇性對該變數加上<strong>註解</strong>。</li>
</ul>
<p><strong>自動建立PHPDoc</strong><br>實務上建立field會有2種方式 :</p>
<ol>
<li>由constructor injection建立field。(如注入service, repository)</li>
<li>由setter與getter建立field。(如strategy, state, adpater,decorator pattern..設定物件)</li>
</ol>
<p>PhpStorm都提供了快速的方式自動建立PHPDoc。</p>
<p><strong>由Constructor Injection建立Field</strong><br><img src="/images/phpstorm/phpstorm-ide-helper/ide028.png" alt=""></p>
<p>新建立了<code>PostService</code>，按熱鍵&#8963; + N，顯示Generate視窗，選擇<code>Constructor...</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide029.png" alt=""></p>
<p>PhpStorm替我們自動產生了constructor框架，我們想藉由constructor注入<code>UserService</code>，輸入<code>UserSer</code>就可以發現PhpStorm的語法提示已經出現了<code>UserService</code>，按&#8617;選擇之。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide030.png" alt=""></p>
<p>在constructor注入了<code>$userService</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide031.png" alt=""></p>
<p>在<code>$userService</code>之後按熱鍵&#8997; + &#8617;，顯示<code>Show Intention Actions</code>視窗，選擇<code>Update PHPDoc Comment</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide032.png" alt=""></p>
<p>由於在constructor的parameter已經有了type hint，因此產生的PHPDoc也自動加上了<code>UserService</code>型別。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide033.png" alt=""></p>
<p>在<code>$userService</code>之後按熱鍵&#8997; + &#8617;，顯示<code>Show Intention Actions</code>視窗，選擇<code>Initialize fields</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide034.png" alt=""></p>
<p>選擇要建立field的constructor parameter。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide035.png" alt=""></p>
<p>PhpStorm不只幫我們在constructor內補上code，還一併幫我們將field建好，而且PHPDoc也一併建立完成，還自動加上了型別。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  藉由PhpStorm這種流程建立field，不僅完全不需要打字，而且連PHPDoc也一併自動寫好，非常方便。</div>
<p><strong>由Setter與Getter建立Field</strong><br><img src="/images/phpstorm/phpstorm-ide-helper/ide036.png" alt=""></p>
<p>還有另外一類field是使用setter/getter建立，這種field就必須先手動建立field。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide037.png" alt=""></p>
<p>新建立了<code>PostService</code>，按熱鍵&#8963; + N，顯示Generate視窗，選擇<code>PHPDoc Blocks...</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide038.png" alt=""></p>
<p>選擇要建立PHPDoc的field。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide039.png" alt=""></p>
<p>PhpStorm自動幫我們產生了<code>@var</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide040.png" alt=""></p>
<p>輸入<code>Pay</code>就可以發現PhpStorm的語法提示已經出現了<code>PaymentInterface</code>，按&#8617;選擇之。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide041.png" alt=""></p>
<p>加上了<code>PaymentInterface</code>型別。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide042.png" alt=""></p>
<p>按熱鍵&#8963; + N，顯示Generate視窗，選擇<code>Getters and Setters...</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide043.png" alt=""></p>
<p>選擇要建立getter與setter的field。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide044.png" alt=""></p>
<p>PhpStorm自動幫我們建立了<code>$paymentService</code>的getter與setter。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  藉由PhpStorm這種流程建立field，僅需手動建立field，補上型別後，剩下的getter與setter都可自動建立，非常方便。</div>
<p><strong>Adapter Pattern</strong><br>實務上在接金流時，由於各家SDK所開的API都不一樣，導致我們處理上的困難，因此我們會使用adapter pattern，將各家API抽象化成相同的API，方便service處理。</p>
<p><strong>PayPalSDK.php</strong><span class="margin-note-marker"><sup>16</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">16</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/a3fd6f8ef9d28457f6012c89797309a54ebf01ef" target="_blank" rel="external">新增PayPalSDK.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/PayPalSDK.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayPalSDK</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pay</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">'PayPal pay '</span> . <span class="variable">$amount</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在此為了講解方便，我們使用<code>PayPalSDK</code>模擬PayPal的付款API，其API為<code>pay()</code>。</p>
<p><strong>AliPaySDK.php</strong><span class="margin-note-marker"><sup>17</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">17</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/5d68b3a21bef2354704569be241d64568434f6b1" target="_blank" rel="external">新增AliPaySDK.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/AliPaySDK.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPaySDK</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> $amount</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bill</span><span class="params">(<span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">'AliPay bill '</span> . <span class="variable">$amount</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在此為了講解方便，我們使用<code>AliPalSDK</code>模擬支付寶的付款API，其API為<code>bill()</code>。</p>
<figure class="highlight php"><figcaption><span>app/Services/Payment/PaymentService.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentService</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 設定第三方支付機構</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> string $paymentName</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPayment</span><span class="params">(string <span class="variable">$paymentName</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但我們原本<code>PaymentService</code>，API為<code>setPayment()</code>與<code>checkout()</code>，其中<code>setPayment()</code>為設定第三方支付機構，而<code>checkout()</code>為實際付款。</p>
<p>可以發現我們service定義的<code>checkout()</code>與PayPal的<code>pay()</code>與支付寶的<code>bill()</code>都不合，因此我們需要adapter pattern做一個轉接動作。</p>
<p><strong>PaymentInterface.php</strong><span class="margin-note-marker"><sup>18</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">18</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/7eed09a13a2425e36b4f76c56efa4edd6f7aa4c7" target="_blank" rel="external">新增PaymentInterface.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/PaymentInterface.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PaymentInterface</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 使用金流付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>定義了<code>PaymentInterface</code>，為我們原本<code>PaymentService</code>所用的<code>checkout()</code>。</p>
<p><strong>PayPal.php</strong><span class="margin-note-marker"><sup>19</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">19</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/a8624e1185ed77e9480736eb27003ed32ae1e0aa" target="_blank" rel="external">新增PayPal.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/PayPal.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PayPal</span> <span class="keyword">implements</span> <span class="title">PaymentInterface</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> PayPalSDK */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$payPalSDK</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * PayPal constructor.</span><br><span class="line">     * <span class="doctag">@param</span> PayPalSDK $payPalSDK</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(PayPalSDK <span class="variable">$payPalSDK</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;payPalSDK = <span class="variable">$payPalSDK</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 使用金流付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;payPalSDK-&gt;pay(<span class="variable">$amount</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>PayPal</code>扮演adapter的角色，所以必須實現<code>PaymentInterface</code>的<code>checkout()</code>。</p>
<p>將扮演adaptee角色的<code>PayPalSDK</code>注入進來。</p>
<p>17行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 使用金流付款</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> int $amount</span><br><span class="line"> * <span class="doctag">@return</span> void</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;payPalSDK-&gt;pay(<span class="variable">$amount</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>將<code>checkout()</code>轉換成<code>PayPalSDK</code>的<code>pay()</code>。</p>
<p><strong>AliPay.php</strong><span class="margin-note-marker"><sup>20</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">20</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/aa8ea09a7025bc9a11131238e3926ccea33cfdfb" target="_blank" rel="external">新增AliPay.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/PayPal.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliPay</span> <span class="keyword">implements</span> <span class="title">PaymentInterface</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> AliPaySDK */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$aliPaySDK</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * AliPay constructor.</span><br><span class="line">     * <span class="doctag">@param</span> AliPaySDK $aliPaySDK</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(AliPaySDK <span class="variable">$aliPaySDK</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;aliPaySDK = <span class="variable">$aliPaySDK</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 使用金流付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     * <span class="doctag">@return</span> void</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;aliPaySDK-&gt;bill(<span class="variable">$amount</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>AliPay</code>扮演adapter的角色，所以必須實現<code>PaymentInterface</code>的<code>checkout()</code>。</p>
<p>將扮演adaptee角色的<code>AliPaySDK</code>注入進來。</p>
<p>17行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 使用金流付款</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> int $amount</span><br><span class="line"> * <span class="doctag">@return</span> void</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;aliPaySDK-&gt;bill(<span class="variable">$amount</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>將<code>checkout()</code>轉換成<code>AliPaySDK</code>的<code>pay()</code>。</p>
<p><strong>PaymentEnum.php</strong><span class="margin-note-marker"><sup>21</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">21</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/0afd8b3efddc40da45a110256420279a478ed183" target="_blank" rel="external">新增PaymentEnum.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/Payment/PaymentEnum.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentEnum</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> PayPal = <span class="string">'PayPal'</span>;</span><br><span class="line">    <span class="keyword">const</span> AliPay = <span class="string">'AliPay'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>PaymentService</code>的<code>setPayment()</code>要求我們傳字串，但由於將來會將此字串直接做<code>App::bind()</code>，為了減少人為typo，我們希望能提供類似強型別語言的<code>enum</code>，在傳入字串時只要用選的就好，不需直接打字。</p>
<p>不過由於PHP沒有提供<code>enum</code>，我們只能使用<code>abstract class</code> + <code>const</code>模擬類似<code>enum</code>的機制。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  PHP模擬的enum，與強型別語言enum的差別在於 : 強型別語言可以在輸入字串使用enum當型別，但PHP還是只能使用string當型別，因此無法如強型別語言透過enum幫你檢查所輸入的資料是否型別正確，不過最少在輸入字串時可以避免typo。</div>
<p><strong>UserController.php</strong><span class="margin-note-marker"><sup>22</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">22</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/b6b229ecd131230c27a6ab3555945063ffbfe6ba" target="_blank" rel="external">修改UserController.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Http/Controllers/UserController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>\<span class="title">PaymentEnum</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">PaymentService</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">UserService</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> UserService  */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$userService</span>;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> PaymentService */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$paymentService</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserController constructor.</span><br><span class="line">     * <span class="doctag">@param</span> UserService $userService</span><br><span class="line">     * <span class="doctag">@param</span> PaymentService $paymentService</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserService <span class="variable">$userService</span>, PaymentService <span class="variable">$paymentService</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;userService = <span class="variable">$userService</span>;</span><br><span class="line">        <span class="variable">$this</span>-&gt;paymentService = <span class="variable">$paymentService</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;userService-&gt;show(<span class="string">'Admin'</span>);</span><br><span class="line">        <span class="variable">$this</span>-&gt;paymentService-&gt;setPayment(PaymentEnum::AliPay);</span><br><span class="line">        <span class="variable">$this</span>-&gt;paymentService-&gt;checkout(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>將<code>PaymentService</code>也注入進來。</p>
<p>26行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;userService-&gt;show(<span class="string">'Admin'</span>);</span><br><span class="line">    <span class="variable">$this</span>-&gt;paymentService-&gt;setPayment(PaymentEnum::AliPay);</span><br><span class="line">    <span class="variable">$this</span>-&gt;paymentService-&gt;checkout(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用<code>$this-&gt;paymentService-&gt;setPayment()</code>設定要用什麼第三方支付機構，這裡使用了<code>PaymentEnum</code>來輸入字串，可以避免人為typo，且程式可讀性也更佳。</p>
<p>無論使用任何第三方支付，都使用相同的<code>$this-&gt;paymentService-&gt;checkout()</code>，若將來有新的第三方支付方式，只需新增class實現<code>PaymentInterface</code>即可，也不用修改<code>UserController</code>，，達到<strong>開放封閉原則</strong>的要求。</p>
<p><strong>PaymentService.php</strong><span class="margin-note-marker"><sup>23</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">23</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/19124db625a5f531a1ab748c8b93e4be4fc28655" target="_blank" rel="external">新增PaymentService.php</a></span></span></span><br><figure class="highlight php"><figcaption><span>app/Services/PaymentService.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Services</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Services</span>\<span class="title">Payment</span>\<span class="title">PaymentInterface</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentService</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> PaymentInterface */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$payment</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 設定第三方支付機構</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> string $paymentName</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPayment</span><span class="params">(string <span class="variable">$paymentName</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        App::bind(PaymentInterface::class, <span class="string">'App\Services\Payment\\'</span> . <span class="variable">$paymentName</span>);</span><br><span class="line">        <span class="variable">$this</span>-&gt;payment = App::make(PaymentInterface::class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 付款</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> int $amount</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;payment-&gt;checkout(<span class="variable">$amount</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>11行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 設定第三方支付機構</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> string $paymentName</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setPayment</span><span class="params">(string <span class="variable">$paymentName</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    App::bind(PaymentInterface::class, <span class="string">'App\Services\Payment\\'</span> . <span class="variable">$paymentName</span>);</span><br><span class="line">    <span class="variable">$this</span>-&gt;payment = App::make(PaymentInterface::class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>將傳進的<code>$paymentName</code>字串，直接做<code>App::bind()</code>。</p>
<p>使用<code>App::make()</code>將剛剛bind的<code>PaymentInterface</code>建立成物件。</p>
<p>22行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 付款</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@param</span> int $amount</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkout</span><span class="params">(int <span class="variable">$amount</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="variable">$this</span>-&gt;payment-&gt;checkout(<span class="variable">$amount</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>由於都實現<code>PaymentInterface</code>，所以只要使用統一個<code>checkout()</code>即可，不用擔心是什麼SDK，就算將來有新的第三方支付SDK，在<code>PaymentService</code>也不用修改，達到<strong>開放封閉原則</strong>的要求。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide022.png" alt=""></p>
<p>回到本文PHPDoc的重點，<code>$this-&gt;payment</code>因為有出現<code>checkout()</code>的語法提示，是因為第10行替<code>private $payment</code>加了<code>@var</code>註解，描述了<code>$payment</code>的型別為<code>PaymentInterface</code>，引此才能出現<code>checkout()</code>的語法提示。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide023.png" alt=""></p>
<p>若將<code>private $payment</code>的PHPDoc拿掉，我們發現PhpStorm將不再出現<code>checkout()</code>語法提示，因為PhpStorm不知道<code>$payment</code>的型別，因此無從顯示語法提示。</p>
<div class="alert alert-info"><i class="fa fa-info"></i>  這個範例除了示範adpater pattern外，也告訴我們使用<strong>@var</strong>替field描述型別的重要性，使用PHPDoc去描述field型別後，PhpStorm就能幫我們替field顯示語法提示，避免typo，也增加開發效率。</div>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  目前PHP 7的field還是沒有type hint，所以field的<strong>@var</strong>是唯一讓PhpStorm得知field型別的管道，非常重要。</div>
<h3 id="Method">Method</h3><p><strong>語法</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span><br><span class="line"> * <span class="doctag">@param</span> 型別 變數名稱 [註解] </span><br><span class="line"> * <span class="doctag">@return</span> 型別 [註解]</span><br><span class="line"> * <span class="doctag">@throws</span> 型別 [註解]</span><br><span class="line"> */</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>@param</code>為傳入參數，<code>@return</code>為回傳值，<code>@throws</code>為exception。</li>
<li><strong>型別</strong>可以是PHP原生型別，class，interface或trait。</li>
<li><code>@param</code>一定要加上<strong>變數名稱</strong>。</li>
<li>可選擇性加上<strong>註解</strong>。</li>
<li>若不傳回值，為<code>@return void</code></li>
</ul>
<p><strong>自動建立PHPDoc</strong><br>實務上建立method會有3種方式 :</p>
<ol>
<li>自行由<code>pubf</code>建立method。</li>
<li>由熱鍵&#8963; + I去實踐<code>abstract class</code>或<code>interface</code>的method。</li>
<li>由<code>extend abstract class</code>或<code>implements interface</code>建立method。</li>
</ol>
<p><strong>自行由pubf建立method</strong><br><img src="/images/phpstorm/phpstorm-ide-helper/ide045.png" alt=""></p>
<p>輸入<code>pubf</code>，按&#8677;。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide046.png" alt=""></p>
<p>產生<code>public function</code>框架。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide047.png" alt=""></p>
<p>自行輸入method名稱，輸入參數型別與名稱，與回傳型別，最後按熱鍵&#8997; + &#8617;，顯示<code>Generate PHPDoc for function</code>，按&#8617;繼續。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide048.png" alt=""></p>
<p>PhpStorm會自動幫你加上PHPDoc，包含<code>@param</code>與<code>@return</code>。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide049.png" alt=""></p>
<p>在PHPDoc第一行加上人看得懂的method註解，描述此method的主要功能，中英文皆可。</p>
<p><strong>由熱鍵&#8963; + I去實踐abstract class或interface的method</strong></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide050.png" alt=""></p>
<p>使用<code>extends</code>繼承<code>abstract class</code>。<span class="margin-note-marker"><sup>24</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">24</span>這裡<code>OrderService</code>去繼承<code>AbstractUser</code><strong>完全不合理</strong>，純粹是為了demo方便。</span></span></span></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide051.png" alt=""></p>
<p>按熱鍵&#8963; + I，選擇要實作的method。</p>
<p>要將<code>Add PhHPDoc</code>與<code>Copy from base class</code>打勾。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide052.png" alt=""></p>
<p>PhpStorm除了會幫我們建立method框架外，連PHPDoc也幫我複製過來了。</p>
<p><strong>由extend abstract class或implements interface建立method</strong></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide053.png" alt=""></p>
<p>使用<code>implements</code>去實現<code>interface</code>。<span class="margin-note-marker"><sup>25</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">25</span>這裡<code>OrderService</code>去實現<code>PaymentInterface</code><strong>完全不合理</strong>，純粹是為了demo方便。</span></span></span></p>
<p>按熱鍵&#8997; + &#8617;，顯示<code>Add method stubs</code>，按&#8617;繼續。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide054.png" alt=""></p>
<p>PhpStorm除了會幫我們建立method框架外，連PHPDoc也幫我複製過來了。</p>
<div class="alert alert-success"><i class="fa fa-lightbulb-o"></i>  在duck type時代，<strong>@param</strong>與<strong>@return</strong>是唯一讓PhpStorm得知method參數與回傳值型別的管道，非常重要，不過在PHP有type hint與PHP 7有return type之後，<strong>@param</strong>與<strong>@return</strong>沒之前重要，目前PhpStorm已經可以自行透過type hint與return type得知變數型別。</div>
<h2 id="Overloading">Overloading</h2><hr>
<h3 id="Property">Property</h3><p><strong>語法</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span><br><span class="line"> * <span class="doctag">@property</span> 型別 變數名稱 [註解] </span><br><span class="line"> */</span></span><br></pre></td></tr></table></figure></p>
<p>若你有使用<code>__get()</code>與<code>__set()</code>動態產生property話，由於是動態產生，PhpStorm無從得知property名稱與其型別，必須依賴<code>@property</code>描述。<span class="margin-note-marker"><sup>26</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">26</span>關於property overloading更詳細的描述，請參考<a href="/php/php-cs/#Property_Overloading">PHP與C#語法快速導覽#Property Overloading</a></span></span></span></p>
<figure class="highlight php"><figcaption><span>app/User.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="title">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * App\User</span><br><span class="line"> *</span><br><span class="line"> * <span class="doctag">@property</span> integer $id</span><br><span class="line"> * <span class="doctag">@property</span> string $name</span><br><span class="line"> * <span class="doctag">@property</span> string $email</span><br><span class="line"> * <span class="doctag">@property</span> string $password</span><br><span class="line"> * <span class="doctag">@property</span> string $remember_token</span><br><span class="line"> * <span class="doctag">@property</span> \Carbon\Carbon $created_at</span><br><span class="line"> * <span class="doctag">@property</span> \Carbon\Carbon $updated_at</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereId($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereName($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereEmail($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User wherePassword($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereRememberToken($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereCreatedAt($value)</span><br><span class="line"> * <span class="doctag">@method</span> static \Illuminate\Database\Query\Builder|\App\User whereUpdatedAt($value)</span><br><span class="line"> * <span class="doctag">@mixin</span> \Eloquent</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * The attributes that are mass assignable.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> array</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [</span><br><span class="line">        <span class="string">'name'</span>, <span class="string">'email'</span>, <span class="string">'password'</span>,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * The attributes excluded from the model's JSON form.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@var</span> array</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hidden</span> = [</span><br><span class="line">        <span class="string">'password'</span>, <span class="string">'remember_token'</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>典型的應用就是Eloquent的model，會根據資料庫欄位動態產生property，Laravel IDE Helper就是利用<code>@property</code>幫我們描述欄位與型別。<span class="margin-note-marker"><sup>27</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">27</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/fd538464f84e4a6c552d933f6882c445be21255e" target="_blank" rel="external">在User.php加入@propery與@method註解</a></span></span></span></p>
<h3 id="Method-1">Method</h3><p><strong>語法</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span><br><span class="line"> * <span class="doctag">@method</span> 回傳型別 函式名稱 ([參數型別] 參數名稱)</span><br><span class="line"> */</span></span><br></pre></td></tr></table></figure></p>
<p>若你有使用<code>__call()</code>與<code>__callStatic()</code>動態產生method話，由於是動態產生，PhpStorm無從得知method名稱、參數與回傳型別，必須依賴<code>@method</code>描述。<span class="margin-note-marker"><sup>28</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">28</span>關於method overloading更詳細的描述，請參考<a href="/php/php-cs/#Method_Overloading">PHP與C#語法快速導覽#Method Overloading</a></span></span></span></p>
<p>之前的<code>User</code> model也看到了<code>@method</code>的使用。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide055.png" alt=""></p>
<p>在之前講migration之處，我們還留了一個未解的反白<code>unique()</code>，其實不只有<code>unique()</code>，一些常用的如<code>nullable()</code>、<code>unsigned()</code>與<code>index()</code>都會反白。</p>
<p>原因就是Laravel使用了method overloading的機制寫這些fluent method，所以PhpStorm無法得知，且目前Laravel IDE Helper也沒幫我們處理，必須自己解決。</p>
<figure class="highlight php"><figcaption><span>_migration_helper.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Support</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * <span class="doctag">@method</span> Fluent first()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent after($column)</span><br><span class="line"> * <span class="doctag">@method</span> Fluent change()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent nullable()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent unsigned()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent unique()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent index()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent primary()</span><br><span class="line"> * <span class="doctag">@method</span> Fluent default($value)</span><br><span class="line"> * <span class="doctag">@method</span> Fluent onUpdate($value)</span><br><span class="line"> * <span class="doctag">@method</span> Fluent onDelete($value)</span><br><span class="line"> * <span class="doctag">@method</span> Fluent references($value)</span><br><span class="line"> * <span class="doctag">@method</span> Fluent on($value)</span><br><span class="line"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fluent</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>自己建立<code>_migration_helper.php</code>放在專案的跟目錄下，使用<code>@method</code>描述這些Laravel IDE Helper沒描述的method。<span class="margin-note-marker"><sup>29</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">29</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/9354d389b0c9a9de62208836e29c011f7dc3eaf1" target="_blank" rel="external">新增_migration_helper.php</a></span></span></span></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide056.png" alt=""></p>
<p><code>unique()</code>就不再反白了，以後<code>nullable()</code>、<code>unsigned()</code>與<code>index()</code>在PhpStorm也都有了語法提示。</p>
<h2 id="Collection">Collection</h2><hr>
<p>Collection是我在Laravel又愛又恨的東西，愛的是collection所提供的method遠比PHP原生array優雅強大，我幾乎完全使用collection取代PHP原生array，恨的是collection與array一樣，我無法得知collection內每個element的型別，因此在<code>foreach()</code>時，PhpStorm無法對collection內物件的property與method做語法提示。</p>
<figure class="highlight php"><figcaption><span>app\Repositories\UserRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> User */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserRepository constructor.</span><br><span class="line">     * <span class="doctag">@param</span> User $user</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User <span class="variable">$user</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 傳回所有User</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> Collection</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllUsers</span><span class="params">()</span> : <span class="title">Collection</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;user-&gt;all();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一個典型的repository應用，repository負責資料庫邏輯，在<code>getAllUsers()</code>傳回<code>Collection</code>。<span class="margin-note-marker"><sup>30</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">30</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/2edefa5286d4d8461c3985da0e3463b30e492f0e" target="_blank" rel="external">新增UserRepository.php</a></span></span></span></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide057.png" alt=""></p>
<p>一個典型的service應用，注入repository後，從<code>UserRepository</code>的<code>getAllUsers()</code>獲得collection，要<code>foreach()</code>時，發現PhpStorm無法對<code>User</code> model的資料庫欄位名稱做語法提示。</p>
<p>之前辛辛苦苦使用Laravel IDE Helper替<code>User</code> model加了PHPDoc，結果在使用collection之後，竟然完全用不上。</p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide058.png" alt=""></p>
<p>很多人的做法，是在<code>foreach()</code>之內補一行<code>/** @var User $user*/</code>描述<code>$user</code>型別，這樣雖然可以另<code>$user</code>出現資料庫欄位的語法提示，但缺點是這種inline PHPDoc很醜，且每次<code>foreach()</code>都要加一次很麻煩。</p>
<p>比較好的方式是將PHPDoc加在UserRepository的<code>@return</code>內。</p>
<figure class="highlight php"><figcaption><span>app\Repositories\UserRepository.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Collection</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRepository</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> User */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * UserRepository constructor.</span><br><span class="line">     * <span class="doctag">@param</span> User $user</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User <span class="variable">$user</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;user = <span class="variable">$user</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 傳回所有User</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@return</span> Collection|User[]</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllUsers</span><span class="params">()</span> : <span class="title">Collection</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;user-&gt;all();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>20行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span><br><span class="line">  * 傳回所有User</span><br><span class="line">  *</span><br><span class="line">  * <span class="doctag">@return</span> Collection|User[]</span><br><span class="line">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllUsers</span><span class="params">()</span> : <span class="title">Collection</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$this</span>-&gt;user-&gt;all();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在<code>@return</code>內除了<code>Collection</code>外，還加上了<code>User[]</code>，這是模仿Java array的宣告方式，目的是告訴PhpStorm這個物件除了是collection，其每個item內的型別是<code>User</code>，因為描述了兩種型別資訊，中間要加上<code>|</code>符號。<span class="margin-note-marker"><sup>31</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">31</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/cf21d33d14fc3d11ef22de657e49162ca72f4aaf" target="_blank" rel="external">UserRepostory.php加上User[]註解</a></span></span></span></p>
<p><img src="/images/phpstorm/phpstorm-ide-helper/ide059.png" alt=""></p>
<p>再也不用每個<code>foreach()</code>都補上inline PHPDoc，就可以讓PhpStorm對collection內的model做資料庫欄位名稱的語法提示。<span class="margin-note-marker"><sup>32</sup></span> <span class="block margin-div-outer"><span class="block margin-div-inner"><span class="block margin-note"><span class="margin-note-marker">32</span>GitHub Commit : <a href="https://github.com/oomusou/Laravel52ServiceContainerMeta/commit/cb8eda4a462a75185fb8a457f3440abbe730fd8a" target="_blank" rel="external">新增UserService.php</a></span></span></span></p>
<h2 id="Conclusion">Conclusion</h2><hr>
<ul>
<li>Laravel IDE Helper + Laravel Plugin幫我們補上了大部分Laravel部分的PHPDoc，但自己寫的class，則有賴自己使用PHPDoc。</li>
<li>隨著PHP 7對type hint的支援更加完整，PHPDoc的重要性沒以往重要，不過對於field，collection與overloading，目前還是得依賴PHPDoc，PhpStorm才能達到較滿意的語法提示與語法檢查功能。</li>
</ul>
<h2 id="Sample_Code">Sample Code</h2><hr>
<p>完整的範例可以在我的<a href="https://github.com/oomusou/Laravel52ServiceContainerMeta" target="_blank" rel="external">GitHub</a>上找到。</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/tdd/tdd-phpunit-native-function/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/tags"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/refactor/refactor-remove-assignments-to-parameters/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
	
	</div> <!-- col-md-9/col-md-12 -->
	
	
		<div class="col-md-3"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-03-04 
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/LaraDiner/">LaraDiner<span>16</span></a></li> <li><a href="/tags/PHPDoc/">PHPDoc<span>3</span></a></li> <li><a href="/tags/PhpStorm/">PhpStorm<span>17</span></a></li>
    </ul>
	</div>
		

    <hr>
	
</div><!-- col-md-3 -->

	

</div><!-- row -->

	</div>
  </div>
  <div class="container-narrow">
  <footer>  </footer>
</div> <!-- container-narrow -->
  
  <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'hAXbiVYFC92XF16_EhCh','2.0.0');
  </script>



  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
   </html>
